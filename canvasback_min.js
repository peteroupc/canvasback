function n(b){function a(){b();p(a)}b();p(a)}function p(b){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;a?a(b):window.setTimeout(b,17)}function q(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}
function r(b,a,d){null==a&&(a="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 textureUV;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float alpha;\nvarying vec2 textureUVVar;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvoid main(){\nvec4 positionVec4=vec4(position,1.0);\nmat4 viewWorld=view*world;\ngl_Position=projection*viewWorld*positionVec4;\nviewPositionVar=vec3(viewWorld*positionVec4);\nnormalVar=normalize(vec3(world*vec4(normal,0.0)));\ntextureUVVar=textureUV;\n}");null==
d&&(d="precision highp float;\nuniform sampler2D sampler;\nuniform int useTexture;\nuniform vec3 sa;\nuniform vec3 sd;\nuniform vec3 ss;\nuniform vec3 sdir;\nuniform vec3 ma;\nuniform vec3 md;\nuniform vec3 ms;\nuniform float mshin;\nuniform vec4 color;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvarying vec2 textureUVVar;\nvoid main(){\n vec3 normNormalVar=normalize(normalVar); vec3 normSdir=normalize(sdir); float diffInt=dot(normNormalVar,normSdir); vec4 baseColor=(useTexture==0) ? color : texture2D(sampler,textureUVVar);\n vec3 phong=(sa*ma)+(sd*md*baseColor.rgb*max(diffInt,0.0));\n if(diffInt>=0.0){\n   phong=phong+(ss*ms*pow(max(dot(reflect(-normSdir,normNormalVar),viewPositionVar),0.0),mshin));\n }\n gl_FragColor=vec4(phong,baseColor.a);\n}");
this.c=t(b,a,d);this.attributes={};this.a=b;this.n={};this.A={};if(null!=this.c){this.attributes=[];var f=null;a={};d=b.getProgramParameter(this.c,b.ACTIVE_ATTRIBUTES);for(var c=0;c<d;++c)if(f=b.getActiveAttrib(this.c,c),null!==f){var f=f.name,e=b.getAttribLocation(this.c,f);0<=e&&(this.attributes.push(e),a[f]=e)}d=b.getProgramParameter(this.c,b.ACTIVE_UNIFORMS);for(c=0;c<d;++c)e=b.getActiveUniform(this.c,c),null!==e&&(f=e.name,a[f]=b.getUniformLocation(this.c,f),this.A[f]=e.type);this.n=a}}
r.prototype.get=function(b){return this.n.hasOwnProperty(b)?this.n[b]:null};function z(b,a){for(var d in a)a.hasOwnProperty(d)&&(v=a[d],3==v.length?b.a.uniform3f(b.get(d),v[0],v[1],v[2]):16==v.length?b.a.uniformMatrix4fv(b.get(d),!1,v):b.A[d]==b.a.FLOAT?b.a.uniform1f(b.get(d),"number"==typeof v?v:v[0]):b.a.uniform1i(b.get(d),"number"==typeof v?v:v[0]))}
function t(b,a,d){function f(d,a,f){var c=d.createShader(a);d.shaderSource(c,f);d.compileShader(c);return d.getShaderParameter(c,d.COMPILE_STATUS)?c:(console.log((a==d.VERTEX_SHADER?"vertex: ":"fragment: ")+d.getShaderInfoLog(c)),null)}a=a&&0!=a.length?f(b,b.VERTEX_SHADER,a):null;d=d&&0!=d.length?f(b,b.FRAGMENT_SHADER,d):null;var c=null;null!==a&&null!==d&&(c=b.createProgram(),b.attachShader(c,a),b.attachShader(c,d),b.linkProgram(c),b.getProgramParameter(c,b.LINK_STATUS)?b.useProgram(c):(console.log("link: "+
b.getProgramInfoLog(c)),b.deleteProgram(c),c=null));null!==a&&b.deleteShader(a);null!==d&&b.deleteShader(d);return c}r.prototype.k=function(b){if(!b)return this;z(this,{sdir:b.direction,sa:b.o,sd:b.q,ss:b.v});return this};r.prototype.l=function(b){if(!b)return this;z(this,{mshin:b.R,ma:b.o,md:b.q,ms:b.v});return this};function A(b,a,d){this.R=null==d?1:Math.max(1,d);this.o=b||[0,0,0];this.q=a||[1,1,1];this.v=b||[.2,.2,.2]}
function B(b,a,d){this.direction=b||[0,0,-1];this.o=a||[1,1,1];this.q=d||[.2,.2,.2];this.v=a||[.2,.2,.2]}
(function(){function b(d,f){this.kind=a.C;this.g=null;this.color=[f[0],f[1],f[2],null==f[3]?1:f[3]];this.a=d}function a(d,a){this.a=d;a.get("color");this.P=a.get("sampler");a.get("useTexture");this.a.uniform1i(this.P,0)}a.C=0;a.TEXTURE=1;a.prototype.r=function(d,a,c){return"number"==typeof d&&"number"==typeof a&&"number"==typeof c?new b(this.a,[d,a,c]):new b(this.a,d)};b.prototype.Q=function(d){this.g=d;return this};b.prototype.bind=function(d){var a=d.get("useTexture");null!==a&&this.a.uniform1i(a,
0);this.a.uniform4f(d.get("color"),this.color[0],this.color[1],this.color[2],this.color[3]);d.l(this.g)};window.Materials=a})(window);
function C(b){this.a=b;this.a.viewport(0,0,1*this.a.canvas.width,1*this.a.canvas.height);this.c=new r(b);this.h=[];this.clearColor=[0,0,0,0];this.N=new Materials(b,this.c);this.a.enable(b.BLEND);this.a.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);z(this.c,{projection:q()});z(this.c,{view:q()});this.k(new B).l(new A);this.a.enable(this.a.DEPTH_TEST);this.a.depthFunc(this.a.LEQUAL);this.a.clearColor(0,0,0,1);this.a.clearDepth(999999);this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT)}
C.prototype.r=function(b,a,d,f){return this.N.r(b,a,d,f)};C.prototype.l=function(b){this.c.l(b);return this};C.prototype.k=function(b){this.c.k(b);return this};C.prototype.u=function(){this.a.clear(this.a.COLOR_BUFFER_BIT);for(var b=0;b<this.h.length;b++)this.h[b].u(this.c);this.a.flush()};function D(b,a){this.w=a;this.a=b;this.g=null;this.scale=[1,1,1];this.e=0;this.position=[0,0,0];this.B=[0,0,0];this.f=!1;this.d=q()}
function E(b,a,d,f,c,e){null!==a&&(b.enableVertexAttribArray(a),b.vertexAttribPointer(a,d,f,!1,c,e))}D.prototype.rotate=function(b){this.e+=b;this.e%=360;this.f=!0;return this};
D.prototype.u=function(b){var a=this.a,d=this.w,f=b.get("position"),c=b.get("normal"),e=b.get("textureUV");a.bindBuffer(a.ARRAY_BUFFER,d.T);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.J);d=d.format;5==d?(E(a,f,3,a.FLOAT,24,0),E(a,c,3,a.FLOAT,24,12)):d==D.D?(E(a,f,3,a.FLOAT,32,0),E(a,c,3,a.FLOAT,32,12),E(a,e,2,a.FLOAT,32,24)):2==d?E(a,f,2,a.FLOAT,8,0):3==d&&E(a,f,3,a.FLOAT,12,0);this.g&&this.g.bind(b);b=b.get("world");if(null!==b){if(this.f){this.f=!1;a=this.scale;this.d=[a[0],0,0,0,0,a[1],0,0,0,0,a[2],
0,0,0,0,1];if(0!=this.e){var a=this.d,e=this.e,f=this.B,f=[f[0],f[1],f[2]],c=f[0],d=f[1],g=f[2];len=Math.sqrt(c*c+d*d+g*g);0!=len&&(len=1/len,f[0]*=len,f[1]*=len,f[2]*=len);var e=e*Math.PI/180,c=Math.cos(e),g=Math.sin(e),d=1-c,h=f[0]*d,e=f[1]*d,d=f[2]*d,l=f[0]*g,k=f[1]*g,m=f[2]*g,g=f[0]*h+c,u=f[0]*e-m,w=f[0]*d+k,m=f[1]*h+m,x=f[1]*e+c,y=f[1]*d-l,h=f[2]*h-k,e=f[2]*e+l,f=f[2]*d+c;this.d=[a[0]*g+a[4]*u+a[8]*w,a[1]*g+a[5]*u+a[9]*w,a[2]*g+a[6]*u+a[10]*w,a[3]*g+a[7]*u+a[11]*w,a[0]*m+a[4]*x+a[8]*y,a[1]*m+
a[5]*x+a[9]*y,a[2]*m+a[6]*x+a[10]*y,a[3]*m+a[7]*x+a[11]*y,a[0]*h+a[4]*e+a[8]*f,a[1]*h+a[5]*e+a[9]*f,a[2]*h+a[6]*e+a[10]*f,a[3]*h+a[7]*e+a[11]*f,a[12],a[13],a[14],a[15]]}this.d[12]+=this.position[0];this.d[13]+=this.position[1];this.d[14]+=this.position[2]}this.a.uniformMatrix4fv(b,!1,this.d)}this.a.drawElements(this.a.TRIANGLES,this.w.K,this.w.type,0)};
(function(b){function a(d){d=d||"#ff0000";this.height=this.width=1E3;var a=$("<canvas>").attr("width",this.width+"").attr("height",this.height+"").css({width:"100%",height:"100%",left:"0px",zIndex:-1,top:"0px",position:"fixed"});$("body").append(a);this.m=!0;this.count=0;if(a=a.get(0)){var c=null,b={antialias:!0};try{c=a.getContext("webgl",b)}catch(g){c=null}if(!c)try{c=a.getContext("experimental-webgl",b)}catch(h){c=null}if(!c)try{c=a.getContext("moz-webgl",b)}catch(l){c=null}if(!c)try{c=a.getContext("webkit-3d",
b)}catch(k){c=null}if(!c)try{c=a.getContext("2d",b)}catch(m){c=null}a=c}else a=null;this.m=(a=this.a=a)&&"compileShader"in a;this.h=[];this.setColor(d)}a.S=function(d){var b=d[0]-7.5+a.b(15);360<=b?b=360-b:0>b&&(b=360+b);var c=d[1],c=15>=c?a.b(30):240<c?240+a.b(30):c-15+a.b(30),e=d=d[2],e=15>=e?a.b(30):240<e?240+a.b(30):e+a.b(30);0<d&&0<c&&255>c&&(25>=c&&(c=25),242<=c&&(c=242));return[b,c,e]};a.b=function(a){return Math.random()*a|0};a.O=function(a){var b=a[0],c=a[1];a=a[2];var e=b;c>e&&(e=c);a>e&&
(e=a);var g=b;c<g&&(g=c);a<g&&(g=a);var h=e+g,l=h/2;if(e===g)return[0,0>l?0:255<l?255:l,0];var g=e-g,h=255*g/(127.5>=l?h:510-h),k=0,k=g/2,k=b===e?(60*(e-a)+k)/g-(60*(e-c)+k)/g:a===e?240+(60*(e-c)+k)/g-(60*(e-b)+k)/g:120+(60*(e-b)+k)/g-(60*(e-a)+k)/g;if(0>k||360<=k)k=(k%360+360)%360;return[k,0>l?0:255<l?255:l,0>h?0:255<h?255:h]};a.t=function(a){var b=1*a[0],c=1*a[1],e=1*a[2],c=0>c?0:255<c?255:c,e=0>e?0:255<e?255:e;if(0===e)return[c,c,c];a=0;127.5>=c?a=c*(255+e)/255:(a=c*e/255,a=c+e-a);var g=2*c-a;
if(0>b||360<=b)b=(b%360+360)%360;var h=b+120;360<=h&&(h-=360);c=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;h=b;e=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;h=b-120;0>h&&(h+=360);b=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;return[0>c?0:255<c?255:c,0>e?0:255<e?255:e,0>b?0:255<b?255:b]};a.p=function(a){a="0"+(a|0).toString(16);return a.substring(a.length-2,a.length)};a.s=function(b){b=a.t(b);return"#"+a.p(b[0])+a.p(b[1])+a.p(b[2])};a.L=function(a){return null==a||"undefined"==
typeof a?null:(a=/^\#([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null};a.prototype.start=function(){n(this.F.bind(this))};a.prototype.setColor=function(a){a=this.constructor.L(a);if(!a)throw Error("invalid color parameter");this.color=a;this.i=this.constructor.O(a);this.H()};a.prototype.H=function(){document.body.style.backgroundColor=this.constructor.s(this.i);if(this.m){var a=this.constructor.t(this.i),b=new B([0,0,-1],[.2,.2,.2],[1.3,
1.3,1.3]);this.M=new A([.2,.2,.2],[1,1,1],1);var c=this.a,e=[-1,-1,1,-1,0,0,1,1,-1,1,1,-1,0,0,1,0,-1,1,-1,-1,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,-1,-1,1,0,0,1,1,1,1,-1,1,0,0,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,1,1,0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,-1,-1,-1,0,0,-1,1,1,-1,1,-1,0,0,-1,1,0,1,1,-1,0,0,-1,0,0,1,-1,-1,0,0,-1,0,1,1,-1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,-1,1,1,0,0,1,0,0,-1,-1,1,0,0,1,0,1],g=[0,1,
2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],h=D.D,l=c.createBuffer(),k=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,l);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k);c.bufferData(c.ARRAY_BUFFER,new Float32Array(e),c.STATIC_DRAW);var m=c.UNSIGNED_SHORT;65536<=e.length||65536<=g.length?(m=c.UNSIGNED_INT,c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint32Array(g),c.STATIC_DRAW)):c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),c.STATIC_DRAW);this.G={T:l,J:k,K:g.length,
type:m,format:h};b=(new C(this.a)).k(b);b.a.clearColor(a[0]/255,a[1]/255,a[2]/255,1);this.j=b}else this.a.fillStyle=this.constructor.s(this.i),this.a.fillRect(0,0,this.width,this.height)};a.prototype.F=function(){this.count++;4<=this.count&&(this.count=0,this.I());this.m&&this.j.u()};a.prototype.I=function(){var a=this.constructor.S(this.i);if(this.m){300<this.h.length&&this.j.h.shift();var b=this.constructor.b(2E3)/1E3-1,c=this.constructor.b(2E3)/1E3-1,e=this.constructor.b(60)/60,g=(16+this.constructor.b(100))/
1E3,h=this.constructor.t(a);h[0]/=255;h[1]/=255;h[2]/=255;var l=this.constructor.b(160),k=[this.constructor.b(60)/30,this.constructor.b(60)/30,this.constructor.b(60)/30],a=new D(this.a,this.G);a.scale=[g,g,g];a.f=!0;a.e=l%360;a.B=k;a.f=!0;a.position=[b,c,e];a.f=!0;b=this.j.r(h).Q(this.M);a.g=b;this.j.h.push(a)}else b=[this.constructor.b(this.width+30)-30,this.constructor.b(this.height+30)-30,32+this.constructor.b(200),32+this.constructor.b(200)],this.a.fillStyle=this.constructor.s(a),this.a.fillRect(b[0],
b[1],b[2],b[3])};a.colorBackground=function(b){$(document).ready(function(){(new a(b)).start()})};b.CanvasBackground=a})(this);
