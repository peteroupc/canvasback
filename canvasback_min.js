function p(b){function a(){b();q(a)}b();q(a)}function q(b){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;a?a(b):window.setTimeout(b,17)}function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}
function t(b,a,c){null==a&&(a="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 textureUV;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float alpha;\nvarying vec2 textureUVVar;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvoid main(){\nvec4 positionVec4=vec4(position,1.0);\nmat4 viewWorld=view*world;\ngl_Position=projection*viewWorld*positionVec4;\nviewPositionVar=vec3(viewWorld*positionVec4);\nnormalVar=normalize(vec3(world*vec4(normal,0.0)));\ntextureUVVar=textureUV;\n}");null==
c&&(c="precision highp float;\nuniform sampler2D sampler;\nuniform int useTexture;\nuniform vec3 sa;\nuniform vec3 sd;\nuniform vec3 ss;\nuniform vec3 sdir;\nuniform vec3 ma;\nuniform vec3 md;\nuniform vec3 ms;\nuniform float mshin;\nuniform vec4 color;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvarying vec2 textureUVVar;\nvoid main(){\n vec3 normNormalVar=normalize(normalVar); vec3 normSdir=normalize(sdir); float diffInt=dot(normNormalVar,normSdir); vec4 baseColor=(useTexture==0) ? color : texture2D(sampler,textureUVVar);\n vec3 phong=(sa*ma)+(sd*md*baseColor.rgb*max(diffInt,0.0));\n if(diffInt>=0.0){\n   phong=phong+(ss*ms*pow(max(dot(reflect(-normSdir,normNormalVar),viewPositionVar),0.0),mshin));\n }\n gl_FragColor=vec4(phong,baseColor.a);\n}");
this.c=y(b,a,c);this.attributes={};this.a=b;this.m={};this.A={};if(null!=this.c){this.attributes=[];var f=null;a={};c=b.getProgramParameter(this.c,b.ACTIVE_ATTRIBUTES);for(var e=0;e<c;++e)if(f=b.getActiveAttrib(this.c,e),null!==f){var f=f.name,d=b.getAttribLocation(this.c,f);0<=d&&(b.enableVertexAttribArray(d),this.attributes.push(d),a[f]=d)}c=b.getProgramParameter(this.c,b.ACTIVE_UNIFORMS);for(e=0;e<c;++e)d=b.getActiveUniform(this.c,e),null!==d&&(f=d.name,a[f]=b.getUniformLocation(this.c,f),this.A[f]=
d.type);this.m=a}}t.prototype.get=function(b){return this.m.hasOwnProperty(b)?this.m[b]:null};function z(b,a){for(var c in a)a.hasOwnProperty(c)&&(v=a[c],3==v.length?b.a.uniform3f(b.get(c),v[0],v[1],v[2]):16==v.length?b.a.uniformMatrix4fv(b.get(c),!1,v):b.A[c]==b.a.FLOAT?b.a.uniform1f(b.get(c),"number"==typeof v?v:v[0]):b.a.uniform1i(b.get(c),"number"==typeof v?v:v[0]))}
function y(b,a,c){function f(c,a,f){var b=c.createShader(a);c.shaderSource(b,f);c.compileShader(b);return c.getShaderParameter(b,c.COMPILE_STATUS)?b:(console.log((a==c.VERTEX_SHADER?"vertex: ":"fragment: ")+c.getShaderInfoLog(b)),null)}a=a&&0!=a.length?f(b,b.VERTEX_SHADER,a):null;c=c&&0!=c.length?f(b,b.FRAGMENT_SHADER,c):null;var e=null;null!==a&&null!==c&&(e=b.createProgram(),b.attachShader(e,a),b.attachShader(e,c),b.linkProgram(e),b.getProgramParameter(e,b.LINK_STATUS)?b.useProgram(e):(console.log("link: "+
b.getProgramInfoLog(e)),b.deleteProgram(e),e=null));null!==a&&b.deleteShader(a);null!==c&&b.deleteShader(c);return e}t.prototype.j=function(b){z(this,{sdir:b.direction,sa:b.n,sd:b.p,ss:b.v});return this};t.prototype.k=function(b){z(this,{mshin:b.P,ma:b.n,md:b.p,ms:b.v});return this};function A(b,a,c){this.P=null==c?1:Math.max(1,c);this.n=b||[0,0,0];this.p=a||[1,1,1];this.v=b||[.2,.2,.2]}function B(b,a,c){this.direction=b||[0,0,-1];this.n=a||[1,1,1];this.p=c||[.2,.2,.2];this.v=a||[.2,.2,.2]}
(function(){function b(c,f){this.kind=a.C;this.color=[f[0],f[1],f[2],null==f[3]?1:f[3]];this.a=c}function a(c,a){this.a=c;a.get("color");this.O=a.get("sampler");a.get("useTexture");this.a.uniform1i(this.O,0)}a.C=0;a.TEXTURE=1;a.prototype.q=function(c,a,e){return"number"==typeof c&&"number"==typeof a&&"number"==typeof e?new b(this.a,[c,a,e]):new b(this.a,c)};b.prototype.bind=function(c){var a=c.get("useTexture");null!==a&&this.a.uniform1i(a,0);this.a.uniform4f(c.get("color"),this.color[0],this.color[1],
this.color[2],this.color[3])};window.Materials=a})(window);
function C(b){this.a=b;this.a.viewport(0,0,1*this.a.canvas.width,1*this.a.canvas.height);this.c=new t(b);this.g=[];this.clearColor=[0,0,0,0];this.M=new Materials(b,this.c);this.a.enable(b.BLEND);this.a.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);z(this.c,{projection:r()});z(this.c,{view:r()});this.j(new B).k(new A);this.a.enable(this.a.DEPTH_TEST);this.a.depthFunc(this.a.LEQUAL);this.a.clearColor(0,0,0,1);this.a.clearDepth(999999);this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT)}
C.prototype.q=function(b,a,c,f){return this.M.q(b,a,c,f)};C.prototype.k=function(b){this.c.k(b);return this};C.prototype.j=function(b){this.c.j(b);return this};C.prototype.u=function(){this.a.clear(this.a.COLOR_BUFFER_BIT);for(var b=0;b<this.g.length;b++)this.g[b].u(this.c);this.a.flush()};function D(b,a){this.w=a;this.a=b;this.t=null;this.scale=[1,1,1];this.e=0;this.position=[0,0,0];this.B=[0,0,0];this.f=!1;this.d=r()}D.prototype.rotate=function(b){this.e+=b;this.e%=360;this.f=!0;return this};
D.prototype.u=function(b){var a=this.a,c=this.w,f=b.get("position"),e=b.get("normal"),d=b.get("textureUV");a.bindBuffer(a.ARRAY_BUFFER,c.R);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.J);c=c.format;5==c?(a.vertexAttribPointer(f,3,a.FLOAT,!1,24,0),a.vertexAttribPointer(e,3,a.FLOAT,!1,24,12)):c==D.D?(a.vertexAttribPointer(f,3,a.FLOAT,!1,32,0),a.vertexAttribPointer(e,3,a.FLOAT,!1,32,12),a.vertexAttribPointer(d,2,a.FLOAT,!1,32,24)):2==c?a.vertexAttribPointer(f,2,a.FLOAT,!1,8,0):3==c&&a.vertexAttribPointer(f,
3,a.FLOAT,!1,12,0);this.t&&this.t.bind(b);b=b.get("world");if(null!==b){if(this.f){this.f=!1;a=this.scale;this.d=[a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,1];if(0!=this.e){var a=this.d,d=this.e,f=this.B,f=[f[0],f[1],f[2]],e=f[0],c=f[1],g=f[2];len=Math.sqrt(e*e+c*c+g*g);0!=len&&(len=1/len,f[0]*=len,f[1]*=len,f[2]*=len);var d=d*Math.PI/180,e=Math.cos(d),g=Math.sin(d),c=1-e,h=f[0]*c,d=f[1]*c,c=f[2]*c,l=f[0]*g,k=f[1]*g,m=f[2]*g,g=f[0]*h+e,n=f[0]*d-m,u=f[0]*c+k,m=f[1]*h+m,w=f[1]*d+e,x=f[1]*c-l,h=f[2]*h-
k,d=f[2]*d+l,f=f[2]*c+e;this.d=[a[0]*g+a[4]*n+a[8]*u,a[1]*g+a[5]*n+a[9]*u,a[2]*g+a[6]*n+a[10]*u,a[3]*g+a[7]*n+a[11]*u,a[0]*m+a[4]*w+a[8]*x,a[1]*m+a[5]*w+a[9]*x,a[2]*m+a[6]*w+a[10]*x,a[3]*m+a[7]*w+a[11]*x,a[0]*h+a[4]*d+a[8]*f,a[1]*h+a[5]*d+a[9]*f,a[2]*h+a[6]*d+a[10]*f,a[3]*h+a[7]*d+a[11]*f,a[12],a[13],a[14],a[15]]}this.d[12]+=this.position[0];this.d[13]+=this.position[1];this.d[14]+=this.position[2]}this.a.uniformMatrix4fv(b,!1,this.d)}this.a.drawElements(this.a.TRIANGLES,this.w.K,this.w.type,0)};
(function(b){function a(c){c=c||"#ff0000";this.height=this.width=1E3;var a=$("<canvas>").attr("width",this.width+"").attr("height",this.height+"").css({width:"100%",height:"100%",left:"0px",zIndex:-1,top:"0px",position:"fixed"});$("body").append(a);this.l=!0;this.count=0;if(a=a.get(0)){var b=null;try{b=a.getContext("webgl",{antialias:!0})}catch(d){b=null}if(!b)try{b=a.getContext("experimental-webgl",{antialias:!0})}catch(g){b=null}if(!b)try{b=a.getContext("moz-webgl",{antialias:!0})}catch(h){b=null}if(!b)try{b=
a.getContext("webkit-3d",{antialias:!0})}catch(l){b=null}if(!b)try{b=a.getContext("2d",{antialias:!0})}catch(k){b=null}a=b}else a=null;this.l=(a=this.a=a)&&"compileShader"in a;this.g=[];this.setColor(c)}a.Q=function(c){var b=c[0]-7.5+a.b(15);360<=b?b=360-b:0>b&&(b=360+b);var e=c[1],e=15>=e?a.b(30):240<e?240+a.b(30):e-15+a.b(30),d=c=c[2],d=15>=d?a.b(30):240<d?240+a.b(30):d+a.b(30);0<c&&0<e&&255>e&&(25>=e&&(e=25),242<=e&&(e=242));return[b,e,d]};a.b=function(a){return Math.random()*a|0};a.N=function(a){var b=
a[0],e=a[1];a=a[2];var d=b;e>d&&(d=e);a>d&&(d=a);var g=b;e<g&&(g=e);a<g&&(g=a);var h=d+g,l=h/2;if(d===g)return[0,0>l?0:255<l?255:l,0];var g=d-g,h=255*g/(127.5>=l?h:510-h),k=0,k=g/2,k=b===d?(60*(d-a)+k)/g-(60*(d-e)+k)/g:a===d?240+(60*(d-e)+k)/g-(60*(d-b)+k)/g:120+(60*(d-b)+k)/g-(60*(d-a)+k)/g;if(0>k||360<=k)k=(k%360+360)%360;return[k,0>l?0:255<l?255:l,0>h?0:255<h?255:h]};a.s=function(a){var b=1*a[0],e=1*a[1],d=1*a[2],e=0>e?0:255<e?255:e,d=0>d?0:255<d?255:d;if(0===d)return[e,e,e];a=0;127.5>=e?a=e*(255+
d)/255:(a=e*d/255,a=e+d-a);var g=2*e-a;if(0>b||360<=b)b=(b%360+360)%360;var h=b+120;360<=h&&(h-=360);e=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;h=b;d=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;h=b-120;0>h&&(h+=360);b=60>h?g+(a-g)*h/60:180>h?a:240>h?g+(a-g)*(240-h)/60:g;return[0>e?0:255<e?255:e,0>d?0:255<d?255:d,0>b?0:255<b?255:b]};a.o=function(a){a="0"+(a|0).toString(16);return a.substring(a.length-2,a.length)};a.r=function(b){b=a.s(b);return"#"+a.o(b[0])+a.o(b[1])+a.o(b[2])};
a.L=function(a){return null==a||"undefined"==typeof a?null:(a=/^\#([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null};a.prototype.start=function(){p(this.F.bind(this))};a.prototype.setColor=function(a){a=this.constructor.L(a);if(!a)throw Error("invalid color parameter");this.color=a;this.h=this.constructor.N(a);this.H()};a.prototype.H=function(){document.body.style.backgroundColor=this.constructor.r(this.h);if(this.l){var a=this.constructor.s(this.h),
b=new B([0,0,-1],[.2,.2,.2],[1.3,1.3,1.3]),e=new A([.2,.2,.2],[1,1,1],1),d=this.a,g=[-1,-1,1,-1,0,0,1,1,-1,1,1,-1,0,0,1,0,-1,1,-1,-1,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,-1,-1,1,0,0,1,1,1,1,-1,1,0,0,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,1,1,0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,-1,-1,-1,0,0,-1,1,1,-1,1,-1,0,0,-1,1,0,1,1,-1,0,0,-1,0,0,1,-1,-1,0,0,-1,0,1,1,-1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,-1,1,1,0,0,1,0,0,-1,
-1,1,0,0,1,0,1],h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],l=D.D,k=d.createBuffer(),m=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,k);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,m);d.bufferData(d.ARRAY_BUFFER,new Float32Array(g),d.STATIC_DRAW);var n=d.UNSIGNED_SHORT;65536<=g.length||65536<=h.length?(n=d.UNSIGNED_INT,d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint32Array(h),d.STATIC_DRAW)):d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),d.STATIC_DRAW);
this.G={R:k,J:m,K:h.length,type:n,format:l};b=(new C(this.a)).j(b).k(e);b.a.clearColor(a[0]/255,a[1]/255,a[2]/255,1);this.i=b}else this.a.fillStyle=this.constructor.r(this.h),this.a.fillRect(0,0,this.width,this.height)};a.prototype.F=function(){this.count++;4<=this.count&&(this.count=0,this.I());this.l&&this.i.u()};a.prototype.I=function(){var a=this.constructor.Q(this.h);if(this.l){300<this.g.length&&this.i.g.shift();var b=this.constructor.b(2E3)/1E3-1,e=this.constructor.b(2E3)/1E3-1,d=this.constructor.b(60)/
60,g=(16+this.constructor.b(100))/1E3,a=this.constructor.s(a);a[0]/=255;a[1]/=255;a[2]/=255;var h=this.constructor.b(160),l=[this.constructor.b(60)/30,this.constructor.b(60)/30,this.constructor.b(60)/30],k=new D(this.a,this.G);k.scale=[g,g,g];k.f=!0;k.e=h%360;k.B=l;k.f=!0;k.position=[b,e,d];k.f=!0;k.t=this.i.q(a);this.i.g.push(k)}else b=[this.constructor.b(this.width+30)-30,this.constructor.b(this.height+30)-30,32+this.constructor.b(200),32+this.constructor.b(200)],this.a.fillStyle=this.constructor.r(a),
this.a.fillRect(b[0],b[1],b[2],b[3])};a.colorBackground=function(b){$(document).ready(function(){(new a(b)).start()})};b.CanvasBackground=a})(this);
