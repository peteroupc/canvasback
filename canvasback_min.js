function z(d){function b(){d();D(b)}d();D(b)}function D(d){var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;b?b(d):window.setTimeout(d,17)}function E(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}
function F(d,b,a){null==b&&(b=G());null==a&&(a=H());this.c=L(d,b,a);this.attributes={};this.a=d;this.k={};this.s={};if(null!=this.c){this.attributes=[];var g=null;b={};a=d.getProgramParameter(this.c,d.ACTIVE_ATTRIBUTES);for(var c=0;c<a;++c)if(g=d.getActiveAttrib(this.c,c),null!==g){var g=g.name,r=d.getAttribLocation(this.c,g);0<=r&&(d.enableVertexAttribArray(r),this.attributes.push(r),b[g]=r)}a=d.getProgramParameter(this.c,d.ACTIVE_UNIFORMS);for(c=0;c<a;++c)r=d.getActiveUniform(this.c,c),null!==r&&
(g=r.name,b[g]=d.getUniformLocation(this.c,g),this.s[g]=r.type);this.k=b}}F.prototype.get=function(d){return this.k.hasOwnProperty(d)?this.k[d]:null};
function L(d,b,a){function g(a,c,g){var b=a.createShader(c);a.shaderSource(b,g);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(console.log((c==a.VERTEX_SHADER?"vertex: ":"fragment: ")+a.getShaderInfoLog(b)),null)}b=b&&0!=b.length?g(d,d.VERTEX_SHADER,b):null;a=a&&0!=a.length?g(d,d.FRAGMENT_SHADER,a):null;var c=null;null!==b&&null!==a&&(c=d.createProgram(),d.attachShader(c,b),d.attachShader(c,a),d.linkProgram(c),d.getProgramParameter(c,d.LINK_STATUS)?d.useProgram(c):(console.log("link: "+
d.getProgramInfoLog(c)),d.deleteProgram(c),c=null));null!==b&&d.deleteShader(b);null!==a&&d.deleteShader(a);return c}
function G(){return"attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 textureUV;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float alpha;\nvarying vec2 textureUVVar;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvoid main(){\nvec4 positionVec4=vec4(position,1.0);\nmat4 viewWorld=view*world;\ngl_Position=projection*viewWorld*positionVec4;\nviewPositionVar=vec3(viewWorld*positionVec4);\nnormalVar=normalize(vec3(world*vec4(normal,0.0)));\ntextureUVVar=textureUV;\n}"}
function H(){return"precision highp float;\nuniform sampler2D sampler;\nuniform int useTexture;\nuniform vec3 sa;\nuniform vec3 sd;\nuniform vec3 ss;\nuniform vec3 sdir;\nuniform vec3 ma;\nuniform vec3 md;\nuniform vec3 ms;\nuniform float mshin;\nuniform vec4 color;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvarying vec2 textureUVVar;\nvoid main(){\n vec3 normNormalVar=normalize(normalVar); vec3 normSdir=normalize(sdir); float diffInt=dot(normNormalVar,normSdir); vec4 baseColor=(useTexture==0) ? color : texture2D(sampler,textureUVVar);\n vec3 phong=(sa*ma)+(sd*md*baseColor.rgb*max(diffInt,0.0));\n if(diffInt>=0.0){\n   phong=phong+(ss*ms*pow(max(dot(reflect(-normSdir,normNormalVar),viewPositionVar),0.0),mshin));\n }\n gl_FragColor=vec4(phong,baseColor.a);\n}"}
(function(){function d(a,g,c,r){this.kind=b.u;this.color=[g[0],g[1],g[2],null==g[3]?1:g[3]];this.a=a;this.r=r;this.l=c}function b(a,g,c,b){this.a=a;this.N=b;this.r=c;this.l=g;this.a.uniform1i(this.r,0)}b.u=0;b.TEXTURE=1;b.prototype.I=function(a){return new d(this.a,a,this.l)};d.prototype.bind=function(){null!==this.Q&&this.a.uniform1i(this.N,0);this.a.uniform4f(this.l,this.color[0],this.color[1],this.color[2],this.color[3])};window.Materials=b})(window);
function M(d,b){this.q=b;this.a=d;this.p=null;this.scale=[1,1,1];this.e=0;this.position=[0,0,0];this.t=[0,0,0];this.f=[];this.g=!1;this.d=E()}M.prototype.getUniform=function(d){for(var b=0;b<this.f.length;b++)if(this.f[b][0]==d)return this.f[b].slice(1,this.f[b].length);return null};M.prototype.rotate=function(d){this.e+=d;this.e%=360;this.g=!0;return this};
(function(d){function b(a){a=a||"#ff0000";this.height=this.width=1E3;var g=$("<canvas>").attr("width",this.width+"").attr("height",this.height+"").css({width:"100%",height:"100%",left:"0px",zIndex:-1,top:"0px",position:"fixed"});$("body").append(g);this.j=!0;if(g=g.get(0)){var c=null;try{c=g.getContext("webgl",{antialias:!0})}catch(b){c=null}if(!c)try{c=g.getContext("experimental-webgl",{antialias:!0})}catch(d){c=null}if(!c)try{c=g.getContext("moz-webgl",{antialias:!0})}catch(h){c=null}if(!c)try{c=
g.getContext("webkit-3d",{antialias:!0})}catch(p){c=null}if(!c)try{c=g.getContext("2d",{antialias:!0})}catch(f){c=null}g=c}else g=null;this.j=(g=this.a=g)&&"compileShader"in g;this.i=[];this.setColor(a)}b.O=function(a){var g=a[0]-7.5+b.b(15);360<=g?g=360-g:0>g&&(g=360+g);var c=a[1],c=15>=c?b.b(30):240<c?240+b.b(30):c-15+b.b(30),r=a=a[2],r=15>=r?b.b(30):240<r?240+b.b(30):r+b.b(30);0<a&&0<c&&255>c&&(25>=c&&(c=25),242<=c&&(c=242));return[g,c,r]};b.b=function(a){return Math.random()*a|0};b.M=function(a){var g=
a[0],c=a[1];a=a[2];var b=g;c>b&&(b=c);a>b&&(b=a);var d=g;c<d&&(d=c);a<d&&(d=a);var h=b+d,p=h/2;if(b===d)return[0,0>p?0:255<p?255:p,0];var d=b-d,h=255*d/(127.5>=p?h:510-h),f=0,f=d/2,f=g===b?(60*(b-a)+f)/d-(60*(b-c)+f)/d:a===b?240+(60*(b-c)+f)/d-(60*(b-g)+f)/d:120+(60*(b-g)+f)/d-(60*(b-a)+f)/d;if(0>f||360<=f)f=(f%360+360)%360;return[f,0>p?0:255<p?255:p,0>h?0:255<h?255:h]};b.o=function(a){var b=1*a[0],c=1*a[1],d=1*a[2],c=0>c?0:255<c?255:c,d=0>d?0:255<d?255:d;if(0===d)return[c,c,c];a=0;127.5>=c?a=c*(255+
d)/255:(a=c*d/255,a=c+d-a);var l=2*c-a;if(0>b||360<=b)b=(b%360+360)%360;var h=b+120;360<=h&&(h-=360);c=60>h?l+(a-l)*h/60:180>h?a:240>h?l+(a-l)*(240-h)/60:l;h=b;d=60>h?l+(a-l)*h/60:180>h?a:240>h?l+(a-l)*(240-h)/60:l;h=b-120;0>h&&(h+=360);b=60>h?l+(a-l)*h/60:180>h?a:240>h?l+(a-l)*(240-h)/60:l;return[0>c?0:255<c?255:c,0>d?0:255<d?255:d,0>b?0:255<b?255:b]};b.m=function(a){a="0"+(a|0).toString(16);return a.substring(a.length-2,a.length)};b.n=function(a){a=b.o(a);return"#"+b.m(a[0])+b.m(a[1])+b.m(a[2])};
b.J=function(a){return null==a||"undefined"==typeof a?null:(a=/^\#([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null};b.prototype.start=function(){z(this.w.bind(this))};b.prototype.setColor=function(a){a=this.constructor.J(a);if(!a)throw Error("invalid color parameter");this.color=a;this.h=this.constructor.M(a);this.D()};b.prototype.D=function(){document.body.style.backgroundColor=this.constructor.n(this.h);if(this.j){var a=this.constructor.o(this.h),
b={sa:[.2,.2,.2],sd:[1.3,1.3,1.3],ss:[1,1,1],sdir:[0,0,-1],ma:[.2,.2,.2],md:[1,1,1],ms:[.2,.2,.2],mshin:[1]};b.projection=E();b.view=E();this.f=b;this.c=new F(this.a,G(),H());this.position=this.c.get("position");this.L=this.c.get("world");this.B=this.c.get("textureUV");this.A=this.c.get("normal");this.K=new Materials(this.a,this.c.get("color"),this.c.get("sampler"),this.c.get("useTexture"));var c=this.a,d=[-1,-1,1,-1,0,0,1,1,-1,1,1,-1,0,0,1,0,-1,1,-1,-1,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,-1,-1,1,0,0,1,
1,1,1,-1,1,0,0,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,1,1,0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,-1,-1,-1,0,0,-1,1,1,-1,1,-1,0,0,-1,1,0,1,1,-1,0,0,-1,0,0,1,-1,-1,0,0,-1,0,1,1,-1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,-1,1,1,0,0,1,0,0,-1,-1,1,0,0,1,0,1],l=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],h=M.v,p=c.createBuffer(),f=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,
p);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,f);c.bufferData(c.ARRAY_BUFFER,new Float32Array(d),c.STATIC_DRAW);var q=c.UNSIGNED_SHORT;65536<=d.length||65536<=l.length?(q=c.UNSIGNED_INT,c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint32Array(l),c.STATIC_DRAW)):c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),c.STATIC_DRAW);this.C={P:p,G:f,H:l.length,type:q,format:h};this.count=0;c=this.a;d=a[0]/255;l=a[1]/255;a=a[2]/255;h=this.a.LEQUAL;c.viewport(0,0,1*c.canvas.width,1*c.canvas.height);c.enable(c.DEPTH_TEST);
c.depthFunc("undefined"==typeof h?c.LEQUAL:h);c.clearColor(d,l,a,1);c.clearDepth(h);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);var a=this.c,e;for(e in b)b.hasOwnProperty(e)&&(v=b[e],3==v.length?a.a.uniform3f(a.get(e),v[0],v[1],v[2]):16==v.length?a.a.uniformMatrix4fv(a.get(e),!1,v):a.s[e]==a.a.FLOAT?a.a.uniform1f(a.get(e),v[0]):a.a.uniform1i(a.get(e),v[0]))}else this.a.fillStyle=this.constructor.n(this.h),this.a.fillRect(0,0,this.width,this.height)};b.prototype.w=function(){this.count++;4<=this.count&&
(this.count=0,this.F());if(this.j){var a=this.a,b=this.i,c=this.position,d=this.A,l=this.B,h=this.L;a.clear(a.COLOR_BUFFER_BIT);for(var p=0;p<b.length;p++){var f=b[p],q=c,e=d,m=l,I=h,k=f.a,n=f.q;k.bindBuffer(k.ARRAY_BUFFER,n.P);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.G);n=n.format;5==n?(k.vertexAttribPointer(q,3,k.FLOAT,!1,24,0),k.vertexAttribPointer(e,3,k.FLOAT,!1,24,12)):n==M.v?(k.vertexAttribPointer(q,3,k.FLOAT,!1,32,0),k.vertexAttribPointer(e,3,k.FLOAT,!1,32,12),k.vertexAttribPointer(m,2,k.FLOAT,
!1,32,24)):2==n?k.vertexAttribPointer(q,2,k.FLOAT,!1,8,0):3==n&&k.vertexAttribPointer(q,3,k.FLOAT,!1,12,0);for(q=0;q<f.f.length;q++)e=f.f[q],4==e.length?f.a.uniform3f(e[0],e[1],e[2],e[3]):5==e.length?f.a.uniform4f(e[0],e[1],e[2],e[3],e[4]):2==e.length&&f.a.uniform1f(e[0],e[1]);f.p&&f.p.bind();if(null!==I){if(f.g){f.g=!1;q=f.scale;f.d=[q[0],0,0,0,0,q[1],0,0,0,0,q[2],0,0,0,0,1];if(0!=f.e){var q=f,e=f.d,n=f.e,m=f.t,k=m=[m[0],m[1],m[2]],u=k[0],t=k[1],x=k[2];len=Math.sqrt(u*u+t*t+x*x);0!=len&&(len=1/len,
k[0]*=len,k[1]*=len,k[2]*=len);var n=n*Math.PI/180,k=Math.cos(n),t=Math.sin(n),u=1-k,w=m[0]*u,n=m[1]*u,u=m[2]*u,J=m[0]*t,K=m[1]*t,y=m[2]*t,t=m[0]*w+k,x=m[0]*n-y,A=m[0]*u+K,y=m[1]*w+y,B=m[1]*n+k,C=m[1]*u-J,w=m[2]*w-K,n=m[2]*n+J,m=m[2]*u+k;q.d=[e[0]*t+e[4]*x+e[8]*A,e[1]*t+e[5]*x+e[9]*A,e[2]*t+e[6]*x+e[10]*A,e[3]*t+e[7]*x+e[11]*A,e[0]*y+e[4]*B+e[8]*C,e[1]*y+e[5]*B+e[9]*C,e[2]*y+e[6]*B+e[10]*C,e[3]*y+e[7]*B+e[11]*C,e[0]*w+e[4]*n+e[8]*m,e[1]*w+e[5]*n+e[9]*m,e[2]*w+e[6]*n+e[10]*m,e[3]*w+e[7]*n+e[11]*m,
e[12],e[13],e[14],e[15]]}f.d[12]+=f.position[0];f.d[13]+=f.position[1];f.d[14]+=f.position[2]}f.a.uniformMatrix4fv(I,!1,f.d)}f.a.drawElements(f.a.TRIANGLES,f.q.H,f.q.type,0)}a.flush()}};b.prototype.F=function(){var a=this.constructor.O(this.h);if(this.j){300<this.i.length&&this.i.shift();var b=this.constructor.b(2E3)/1E3-1,c=this.constructor.b(2E3)/1E3-1,d=this.constructor.b(60)/60,l=(16+this.constructor.b(100))/1E3,a=this.constructor.o(a);a[0]/=255;a[1]/=255;a[2]/=255;var h=this.constructor.b(160),
p=[this.constructor.b(60)/30,this.constructor.b(60)/30,this.constructor.b(60)/30],f=new M(this.a,this.C);f.scale=[l,l,l];f.g=!0;f.e=h%360;f.t=p;f.g=!0;f.position=[b,c,d];f.g=!0;f.p=this.K.I(a);this.i.push(f)}else b=[this.constructor.b(this.width+30)-30,this.constructor.b(this.height+30)-30,32+this.constructor.b(200),32+this.constructor.b(200)],this.a.fillStyle=this.constructor.n(a),this.a.fillRect(b[0],b[1],b[2],b[3])};b.colorBackground=function(a){$(document).ready(function(){(new b(a)).start()})};
d.CanvasBackground=b})(this);
