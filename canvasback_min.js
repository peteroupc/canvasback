function x(d){function c(){d();B(c)}d();B(c)}function B(d){var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;c?c(d):window.setTimeout(d,17)}function C(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}
function D(d,c,a){null==c&&(c="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 textureUV;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float alpha;\nvarying vec2 textureUVVar;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvoid main(){\nvec4 positionVec4=vec4(position,1.0);\nmat4 viewWorld=view*world;\ngl_Position=projection*viewWorld*positionVec4;\nviewPositionVar=vec3(viewWorld*positionVec4);\nnormalVar=normalize(vec3(world*vec4(normal,0.0)));\ntextureUVVar=textureUV;\n}");null==
a&&(a="precision highp float;\nuniform sampler2D sampler;\nuniform int useTexture;\nuniform vec3 sa;\nuniform vec3 sd;\nuniform vec3 ss;\nuniform vec3 sdir;\nuniform vec3 ma;\nuniform vec3 md;\nuniform vec3 ms;\nuniform float mshin;\nuniform vec4 color;\nvarying vec3 normalVar;\nvarying vec3 viewPositionVar;\nvarying vec2 textureUVVar;\nvoid main(){\n vec3 normNormalVar=normalize(normalVar); vec3 normSdir=normalize(sdir); float diffInt=dot(normNormalVar,normSdir); vec4 baseColor=(useTexture==0) ? color : texture2D(sampler,textureUVVar);\n vec3 phong=(sa*ma)+(sd*md*baseColor.rgb*max(diffInt,0.0));\n if(diffInt>=0.0){\n   phong=phong+(ss*ms*pow(max(dot(reflect(-normSdir,normNormalVar),viewPositionVar),0.0),mshin));\n }\n gl_FragColor=vec4(phong,baseColor.a);\n}");
this.c=E(d,c,a);this.attributes={};this.a=d;this.j={};this.u={};if(null!=this.c){this.attributes=[];var k=null;c={};a=d.getProgramParameter(this.c,d.ACTIVE_ATTRIBUTES);for(var b=0;b<a;++b)if(k=d.getActiveAttrib(this.c,b),null!==k){var k=k.name,r=d.getAttribLocation(this.c,k);0<=r&&(d.enableVertexAttribArray(r),this.attributes.push(r),c[k]=r)}a=d.getProgramParameter(this.c,d.ACTIVE_UNIFORMS);for(b=0;b<a;++b)r=d.getActiveUniform(this.c,b),null!==r&&(k=r.name,c[k]=d.getUniformLocation(this.c,k),this.u[k]=
r.type);this.j=c}}D.prototype.get=function(d){return this.j.hasOwnProperty(d)?this.j[d]:null};function H(d,c){for(var a in c)c.hasOwnProperty(a)&&(v=c[a],3==v.length?d.a.uniform3f(d.get(a),v[0],v[1],v[2]):16==v.length?d.a.uniformMatrix4fv(d.get(a),!1,v):d.u[a]==d.a.FLOAT?d.a.uniform1f(d.get(a),"number"==typeof v?v:v[0]):d.a.uniform1i(d.get(a),"number"==typeof v?v:v[0]))}
function E(d,c,a){function k(a,b,k){var d=a.createShader(b);a.shaderSource(d,k);a.compileShader(d);return a.getShaderParameter(d,a.COMPILE_STATUS)?d:(console.log((b==a.VERTEX_SHADER?"vertex: ":"fragment: ")+a.getShaderInfoLog(d)),null)}c=c&&0!=c.length?k(d,d.VERTEX_SHADER,c):null;a=a&&0!=a.length?k(d,d.FRAGMENT_SHADER,a):null;var b=null;null!==c&&null!==a&&(b=d.createProgram(),d.attachShader(b,c),d.attachShader(b,a),d.linkProgram(b),d.getProgramParameter(b,d.LINK_STATUS)?d.useProgram(b):(console.log("link: "+
d.getProgramInfoLog(b)),d.deleteProgram(b),b=null));null!==c&&d.deleteShader(c);null!==a&&d.deleteShader(a);return b}function I(){var d=[.2,.2,.2];this.N=Math.max(1,1);this.k=d||[0,0,0];this.n=[1,1,1];this.r=d||[.2,.2,.2]}function J(){var d=[.2,.2,.2];this.direction=[0,0,-1];this.k=d||[1,1,1];this.n=[1.3,1.3,1.3];this.r=d||[.2,.2,.2]}
(function(){function d(a,k,b,d){this.kind=c.A;this.color=[k[0],k[1],k[2],null==k[3]?1:k[3]];this.a=a;this.t=d;this.l=b}function c(a,k,b,d){this.a=a;this.v=d;this.t=b;this.l=k;this.a.uniform1i(this.t,0)}c.A=0;c.TEXTURE=1;c.prototype.J=function(a){return new d(this.a,a,this.l)};d.prototype.bind=function(){null!==this.v&&this.a.uniform1i(this.v,0);this.a.uniform4f(this.l,this.color[0],this.color[1],this.color[2],this.color[3])};window.Materials=c})(window);
function K(d,c){this.s=c;this.a=d;this.q=null;this.scale=[1,1,1];this.e=0;this.position=[0,0,0];this.w=[0,0,0];this.f=!1;this.d=C()}K.prototype.rotate=function(d){this.e+=d;this.e%=360;this.f=!0;return this};
(function(d){function c(a){a=a||"#ff0000";this.height=this.width=1E3;var k=$("<canvas>").attr("width",this.width+"").attr("height",this.height+"").css({width:"100%",height:"100%",left:"0px",zIndex:-1,top:"0px",position:"fixed"});$("body").append(k);this.i=!0;if(k=k.get(0)){var b=null;try{b=k.getContext("webgl",{antialias:!0})}catch(d){b=null}if(!b)try{b=k.getContext("experimental-webgl",{antialias:!0})}catch(e){b=null}if(!b)try{b=k.getContext("moz-webgl",{antialias:!0})}catch(c){b=null}if(!b)try{b=
k.getContext("webkit-3d",{antialias:!0})}catch(l){b=null}if(!b)try{b=k.getContext("2d",{antialias:!0})}catch(f){b=null}k=b}else k=null;this.i=(k=this.a=k)&&"compileShader"in k;this.h=[];this.setColor(a)}c.O=function(a){var k=a[0]-7.5+c.b(15);360<=k?k=360-k:0>k&&(k=360+k);var b=a[1],b=15>=b?c.b(30):240<b?240+c.b(30):b-15+c.b(30),d=a=a[2],d=15>=d?c.b(30):240<d?240+c.b(30):d+c.b(30);0<a&&0<b&&255>b&&(25>=b&&(b=25),242<=b&&(b=242));return[k,b,d]};c.b=function(a){return Math.random()*a|0};c.M=function(a){var d=
a[0],b=a[1];a=a[2];var c=d;b>c&&(c=b);a>c&&(c=a);var e=d;b<e&&(e=b);a<e&&(e=a);var h=c+e,l=h/2;if(c===e)return[0,0>l?0:255<l?255:l,0];var e=c-e,h=255*e/(127.5>=l?h:510-h),f=0,f=e/2,f=d===c?(60*(c-a)+f)/e-(60*(c-b)+f)/e:a===c?240+(60*(c-b)+f)/e-(60*(c-d)+f)/e:120+(60*(c-d)+f)/e-(60*(c-a)+f)/e;if(0>f||360<=f)f=(f%360+360)%360;return[f,0>l?0:255<l?255:l,0>h?0:255<h?255:h]};c.p=function(a){var d=1*a[0],b=1*a[1],c=1*a[2],b=0>b?0:255<b?255:b,c=0>c?0:255<c?255:c;if(0===c)return[b,b,b];a=0;127.5>=b?a=b*(255+
c)/255:(a=b*c/255,a=b+c-a);var e=2*b-a;if(0>d||360<=d)d=(d%360+360)%360;var h=d+120;360<=h&&(h-=360);b=60>h?e+(a-e)*h/60:180>h?a:240>h?e+(a-e)*(240-h)/60:e;h=d;c=60>h?e+(a-e)*h/60:180>h?a:240>h?e+(a-e)*(240-h)/60:e;h=d-120;0>h&&(h+=360);d=60>h?e+(a-e)*h/60:180>h?a:240>h?e+(a-e)*(240-h)/60:e;return[0>b?0:255<b?255:b,0>c?0:255<c?255:c,0>d?0:255<d?255:d]};c.m=function(a){a="0"+(a|0).toString(16);return a.substring(a.length-2,a.length)};c.o=function(a){a=c.p(a);return"#"+c.m(a[0])+c.m(a[1])+c.m(a[2])};
c.K=function(a){return null==a||"undefined"==typeof a?null:(a=/^\#([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null};c.prototype.start=function(){x(this.C.bind(this))};c.prototype.setColor=function(a){a=this.constructor.K(a);if(!a)throw Error("invalid color parameter");this.color=a;this.g=this.constructor.M(a);this.F()};c.prototype.F=function(){document.body.style.backgroundColor=this.constructor.o(this.g);if(this.i){var a=this.constructor.p(this.g),
d={},b=new J,c=new I;d.projection=C();d.view=C();this.c=new D(this.a);H(this.c,{sdir:b.direction,sa:b.k,sd:b.n,ss:b.r});H(this.c,{mshin:c.N,ma:c.k,md:c.n,ms:c.r});this.L=new Materials(this.a,this.c.get("color"),this.c.get("sampler"),this.c.get("useTexture"));var b=this.a,c=[-1,-1,1,-1,0,0,1,1,-1,1,1,-1,0,0,1,0,-1,1,-1,-1,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,-1,-1,1,0,0,1,1,1,1,-1,1,0,0,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,1,1,
0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,-1,-1,-1,0,0,-1,1,1,-1,1,-1,0,0,-1,1,0,1,1,-1,0,0,-1,0,0,1,-1,-1,0,0,-1,0,1,1,-1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,-1,1,1,0,0,1,0,0,-1,-1,1,0,0,1,0,1],e=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],h=K.B,l=b.createBuffer(),f=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,f);b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW);var g=b.UNSIGNED_SHORT;
65536<=c.length||65536<=e.length?(g=b.UNSIGNED_INT,b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint32Array(e),b.STATIC_DRAW)):b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),b.STATIC_DRAW);this.D={P:l,H:f,I:e.length,type:g,format:h};this.count=0;b=this.a;c=a[0]/255;e=a[1]/255;a=a[2]/255;h=this.a.LEQUAL;b.viewport(0,0,1*b.canvas.width,1*b.canvas.height);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.depthFunc("undefined"==typeof h?b.LEQUAL:h);b.clearColor(c,
e,a,1);b.clearDepth(h);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);H(this.c,d)}else this.a.fillStyle=this.constructor.o(this.g),this.a.fillRect(0,0,this.width,this.height)};c.prototype.C=function(){this.count++;4<=this.count&&(this.count=0,this.G());if(this.i){var a=this.a,d=this.h,b=this.c;a.clear(a.COLOR_BUFFER_BIT);for(var c=0;c<d.length;c++){var e=d[c],h=b,l=e.a,f=e.s,g=h.get("position"),m=h.get("normal"),n=h.get("textureUV");l.bindBuffer(l.ARRAY_BUFFER,f.P);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,
f.H);f=f.format;5==f?(l.vertexAttribPointer(g,3,l.FLOAT,!1,24,0),l.vertexAttribPointer(m,3,l.FLOAT,!1,24,12)):f==K.B?(l.vertexAttribPointer(g,3,l.FLOAT,!1,32,0),l.vertexAttribPointer(m,3,l.FLOAT,!1,32,12),l.vertexAttribPointer(n,2,l.FLOAT,!1,32,24)):2==f?l.vertexAttribPointer(g,2,l.FLOAT,!1,8,0):3==f&&l.vertexAttribPointer(g,3,l.FLOAT,!1,12,0);e.q&&e.q.bind();h=h.get("world");if(null!==h){if(e.f){e.f=!1;l=e.scale;e.d=[l[0],0,0,0,0,l[1],0,0,0,0,l[2],0,0,0,0,1];if(0!=e.e){var l=e,g=e.d,f=e.e,m=e.w,
n=m=[m[0],m[1],m[2]],q=n[0],p=n[1],u=n[2];len=Math.sqrt(q*q+p*p+u*u);0!=len&&(len=1/len,n[0]*=len,n[1]*=len,n[2]*=len);var f=f*Math.PI/180,n=Math.cos(f),p=Math.sin(f),q=1-n,t=m[0]*q,f=m[1]*q,q=m[2]*q,F=m[0]*p,G=m[1]*p,w=m[2]*p,p=m[0]*t+n,u=m[0]*f-w,y=m[0]*q+G,w=m[1]*t+w,z=m[1]*f+n,A=m[1]*q-F,t=m[2]*t-G,f=m[2]*f+F,m=m[2]*q+n;l.d=[g[0]*p+g[4]*u+g[8]*y,g[1]*p+g[5]*u+g[9]*y,g[2]*p+g[6]*u+g[10]*y,g[3]*p+g[7]*u+g[11]*y,g[0]*w+g[4]*z+g[8]*A,g[1]*w+g[5]*z+g[9]*A,g[2]*w+g[6]*z+g[10]*A,g[3]*w+g[7]*z+g[11]*
A,g[0]*t+g[4]*f+g[8]*m,g[1]*t+g[5]*f+g[9]*m,g[2]*t+g[6]*f+g[10]*m,g[3]*t+g[7]*f+g[11]*m,g[12],g[13],g[14],g[15]]}e.d[12]+=e.position[0];e.d[13]+=e.position[1];e.d[14]+=e.position[2]}e.a.uniformMatrix4fv(h,!1,e.d)}e.a.drawElements(e.a.TRIANGLES,e.s.I,e.s.type,0)}a.flush()}};c.prototype.G=function(){var a=this.constructor.O(this.g);if(this.i){300<this.h.length&&this.h.shift();var c=this.constructor.b(2E3)/1E3-1,b=this.constructor.b(2E3)/1E3-1,d=this.constructor.b(60)/60,e=(16+this.constructor.b(100))/
1E3,a=this.constructor.p(a);a[0]/=255;a[1]/=255;a[2]/=255;var h=this.constructor.b(160),l=[this.constructor.b(60)/30,this.constructor.b(60)/30,this.constructor.b(60)/30],f=new K(this.a,this.D);f.scale=[e,e,e];f.f=!0;f.e=h%360;f.w=l;f.f=!0;f.position=[c,b,d];f.f=!0;f.q=this.L.J(a);this.h.push(f)}else c=[this.constructor.b(this.width+30)-30,this.constructor.b(this.height+30)-30,32+this.constructor.b(200),32+this.constructor.b(200)],this.a.fillStyle=this.constructor.o(a),this.a.fillRect(c[0],c[1],c[2],
c[3])};c.colorBackground=function(a){$(document).ready(function(){(new c(a)).start()})};d.CanvasBackground=c})(this);
